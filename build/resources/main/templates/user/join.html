<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/basic.html}">

<head>
    <title>MOMO join page</title>
    <meta charset="UTF-8">
    <script th:inline="javascript">
        function validateForm() {
            const userId = document.forms["registerForm"]["userId"].value;
            const userNickname = document.forms["registerForm"]["userNickname"].value;
            const userPw = document.forms["registerForm"]["userPw"].value;
            const userEmail = document.forms["registerForm"]["userEmail"].value;
            const userGender = document.forms["registerForm"]["userGender"].value;
            const userBirth = document.forms["registerForm"]["userBirth"].value;

            //유효성 조건
            const userIdPattern = /^[a-zA-Z0-9]{5,15}$/;
            const emailPattern = /^[a-zA-Z0-9]+@([\w-]+\.)+[\w-]{2,4}$/;
            const passwordPattern = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])[a-zA-Z\d!@#$%^&*(),.?":{}|<>]{8,20}$/;
            const NicknamePattern = /^[가-힣a-zA-Z0-9]{2,12}$/;

            if (!userIdPattern.test(userId)) {
                alert("사용자 ID는 5~15자의 영문자와 숫자로만 구성되어야 합니다.");
                return false;
            }
            if (!passwordPattern.test(userPw)) {
                alert("비밀번호는 8~20자 사이여야 하며, 영문자, 숫자, 특수문자 중 2종류 이상을 포함해야 합니다.");
                return false;
            }
            if (!NicknamePattern.test(userNickname)) {
                alert("문자나 숫자를 사용하여 2~12자로 작성해야 합니다..");
                return false;
            }
            if (!emailPattern.test(userEmail)) {
                alert("이메일 형식이 유효하지 않습니다.");
                return false;
            }
            if (userGender !== "m" && userGender !== "w") {
                alert("성별이 유효하지 않습니다.");
                return false;
            }
            if (userBirth === "") {
                alert("생년월일이 필요합니다.");
                return false;
            }
            // 추가 유효성 검사 (선택 사항)
            // 예시: 카테고리, 주소, MBTI 등
            return true;
        }
        //ID EMAIL 증복체크
        async function checkUserId(userId) {
            const response = await fetch(`/users/check-userId?userId=${userId}`);
            return response.json();
        }
        async function checkEmail(userEmail) {
            const response = await fetch(`/users/check-userEmail?userEmail=${userEmail}`);
            return response.json();
        }
        async function checkUserDetails() {
            const userId = document.getElementById('userId').value;
            const userEmail = document.getElementById('userEmail').value;
            if (await checkUserId(userId)) {
                alert('UserId is already taken');
                return;
            }
            if (await checkEmail(userEmail)) {
                alert('Email is already taken');
                return;
            }
            alert('UserId and Email are available');
        }
    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="row mt-3">
        <div class="col">
            <div class="card">
                <div class="card-header">
                    MOMO 회원가입
                </div>
                <div class="card-body">
                    <form id="registerForm" name="registerForm" action="/user/join" method="post" onsubmit="return validateForm()">
                        <div class="input-group mb-3">
                            <span class="input-group-text">아이디</span>
                            <input type="text" name="userId" class="form-control" required>
                            <button type="button" onclick="checkUserDetails()">Check Details</button>
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">비밀번호</span>
                            <input type="password" name="userPw" class="form-control" required>
                        </div>

                        <!-- 비밀번호 확인 부분 주석 -->
                        <!--
                        <div class="input-group mb-3">
                            <span class="input-group-text">비밀번호 확인</span>
                            <input type="password" name="userPw2" class="form-control">
                        </div>
                        -->

                        <div class="input-group mb-3">
                            <span class="input-group-text">닉네임</span>
                            <input type="text" name="userNickname" class="form-control" required>
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">성별</span>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="userGender" id="male" value="m" required>
                                <label class="form-check-label" for="male">남성</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="userGender" id="female" value="w" required>
                                <label class="form-check-label" for="female">여성</label>
                            </div>
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">생년월일</span>
                            <input type="date" class="form-control" name="userBirth" required>
                        </div>

                        <!-- 나이 입력 부분 주석 -->
                        <!--
                        <div class="input-group mb-3">
                            <span class="input-group-text">나이</span>
                            <input type="number" class="form-control" name="userAge" min="0" max="120" required>
                        </div>
                        -->

                        <div class="input-group mb-3">
                            <span class="input-group-text">이메일</span>
                            <input type="email" class="form-control" name="userEmail" required>
                            <button type="button" onclick="checkUserDetails()">Check Details</button>
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">관심사</span>
                            <input type="text" name="userCategory" class="form-control">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">주소</span>
                            <input type="text" name="userAddress" class="form-control">
                        </div>

                        <div class="input-group mb-3">
                            <span class="input-group-text">Mbti</span>
                            <input type="text" name="userMbti" class="form-control">
                        </div>
                        <form action="/submit" method="post">
                            <!-- 폼 필드들 -->
                        <div class="mt-4">
                            <div class="float-end">
                                <button type="submit" class="btn btn-primary submitBtn">등록</button>
                                <button type="reset" class="btn btn-secondary">취소</button>
                            </div>
                        </div>
                    </form>
                </div><!--end card body-->
            </div><!--end card-->
        </div><!--end col-->
    </div><!--end row-->
</div>

</body>
</html>