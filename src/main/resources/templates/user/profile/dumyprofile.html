<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>프로필 페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- 모달 스타일 -->
    <style>
        #myModal {
            display: none; /* 기본적으로 모달을 숨김 */
            position: fixed; /* 화면에 고정 */
            z-index: 1; /* 다른 요소 위에 표시 */
            left: 0;
            top: 0;
            width: 100%; /* 전체 너비 */
            height: 100%; /* 전체 높이 */
            overflow: auto; /* 필요시 스크롤 가능 */
            background-color: rgba(0, 0, 0, 0.4); /* 반투명 배경 */
            padding-top: 60px; /* 상단 여백 */
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* 중앙 정렬 */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* 너비 */
        }
    </style>
</head>
<body>
<div class="container">
    <h1>사용자 프로필</h1>
    <div>
        <p>프로필 사진: <img th:src="@{${user.userPhoto}}" alt="프로필 사진" width="100" height="100"/></p>
        <p>닉네임: <span th:text="${user.userNickname}"></span></p>
        <p>MBTI: <span th:text="${user.userMBTI}"></span></p>
        <p>나이: <span th:text="${user.userAge}"></span> 성별: <span th:text="${user.userGender}"></span></p>
        <p>주소: <span th:text="${user.userAddress}"></span></p>
        <p>사용자 관심사: <span th:text="${user.userCategory}"></span></p>
        <p>좋아요 수: <span th:text="${user.userLikeNumber}"></span></p>
    </div>
</div>
    <div>
        <button onclick="location.href='/home'">홈으로</button>
    </div>
    <div>
        <button th:if="${loggedInUserId == user.userId}" onclick="location.href='/user/profile/my-report'">내 신고내역</button>
    </div>
<!-- 신고 버튼 -->
<div><!-- 자기 자신이 로그인했으면 버튼 안보이게 함 <button th:if="${loggedInUserId != user.userId}" -->
    <button th:if="${loggedInUserId != user.userId}" onclick="openModal()" class="btn btn-primary">신고하기</button>

    <div th:if="${errorCategoryMessage}" style="color: red;">
        <p th:text="${errorCategoryMessage}"></p> <!-- 에러 메시지 표시 -->
    </div>
    <div    th:if="${successMessage}" style="color: blue;">
        <p th:text="${successMessage}"></p>
    </div>
</div>
<!-- 신고 버튼 끝 -->

<!-- 신고 모달창 -->
<div id="myModal">
    <div class="modal-content">
        <nav class="navbar bg-body-tertiary">
            <div class="container-fluid d-flex flex-column align-items-center">
                <h2>신고하기</h2>
            </div>
            <form th:action="@{/report/create(reportedUserId =${user.userNo})}" method="post" class="form-container">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="스팸/도배" id="spam">
                    <label class="form-check-label" for="spam">스팸/도배</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="음란물" id="porn">
                    <label class="form-check-label" for="porn">음란성</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="불법" id="illegal">
                    <label class="form-check-label" for="illegal">법규 위반</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="유해물" id="harmful">
                    <label class="form-check-label" for="harmful">청소년 유해물</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="부적절한 용어" id="political">
                    <label class="form-check-label" for="political">부적절한 단어 사용</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="사생활" id="privacy">
                    <label class="form-check-label" for="privacy">개인정보 침해</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="reportCategory" value="불쾌한 표현" id="unpleasant">
                    <label class="form-check-label" for="unpleasant">불쾌한 표현 사용</label>
                </div>
                <div class="report-button-container d-grid gap-4 col-6 mx-auto mt-6">
                    <input type="hidden" name="reporterId" th:value="${#authentication.name}">
                    <input type="hidden" name="reportedNo" id="reportedNo"> <!-- 모달 안의 신고할 유저 ID -->
                    <button type="button" onclick="document.forms[0].submit();">확인</button> <!-- 신고 제출 -->
                </div>
            </form>
        </nav>
        <span onclick="closeModal()" style="cursor:pointer; float:right;">닫기</span>
    </div>
</div>
<!-- 신고 모달창 끝 -->
</body>

<!-- 모달 기능 -->
<script>
    function openModal() {
        document.getElementById('myModal').style.display = 'block'; // 모달 표시

        const radioButtons = document.querySelectorAll('#myModal input[type="radio"]');
        radioButtons.forEach(function(radio) {
            radio.checked = false; // 모든 라디오 버튼의 선택 해제
        });
    }
    function closeModal() {
        document.getElementById('myModal').style.display = 'none'; // 모달 닫기
    }
    // 배경 클릭 시 모달 닫기
    window.onclick = function(event) {
        if (event.target === document.getElementById('myModal')) {
            closeModal();
        }
    }
    // ESC 키로 모달 닫기
    window.onkeydown = function(event) {
        if (event.key === "Escape") {
            closeModal();
        }
    }
    <!-- 모달 기능 끝 -->
</script>
</html>
